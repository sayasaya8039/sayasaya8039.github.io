# ファミリーマート新商品画像ダウンローダー Chrome拡張機能

ファミリーマートの「来週の新商品」ページから、5個以上の新商品が掲載されている場合に、新商品の画像を一括ダウンロードするChrome拡張機能です。

## 特徴

- **右クリック禁止サイトに対応**: サイトで右クリックが禁止されていても、ソースコードから直接画像URLを取得してダウンロードします
- **5個以上の条件チェック**: 新商品が5個以上ある場合のみダウンロードボタンが有効になります
- **バッジ表示**: ページ上で検出された新商品の数がブラウザのツールバーのアイコンにバッジとして表示されます
- **自動ファイル名生成**: 商品名を元に、適切なファイル名で画像を保存します
- **プログレス表示**: ダウンロードの進行状況をリアルタイムで表示します

## インストール方法

### 1. 拡張機能を読み込む

1. Chrome ブラウザで `chrome://extensions/` を開く
2. 右上の「デベロッパーモード」をONにする
3. 「パッケージ化されていない拡張機能を読み込む」をクリック
4. この `famima-extension` フォルダを選択

### 2. 必要なもの

- Google Chrome または Chromium ベースのブラウザ（Edge、Brave など）
- ダウンロード権限が許可されている必要があります

## 使い方

### 基本的な使い方

1. ファミリーマートの「来週の新商品」ページを開く
   - URL: https://www.family.co.jp/goods/newgoods/nextweek.html

2. ページが読み込まれると、ブラウザのツールバーの拡張機能アイコンにバッジが表示されます
   - 5個以上: 緑色のバッジ（ダウンロード可能）
   - 5個未満: グレーのバッジ（条件未達成）

3. 拡張機能のアイコンをクリックしてポップアップを開く

4. 商品数を確認し、「画像をダウンロード」ボタンをクリック

5. 画像が自動的に `famima_images` フォルダにダウンロードされます

### ダウンロードされるファイル

- 保存先: `ダウンロード/famima_images/`
- ファイル名形式: `famima_01_商品名.jpg`
  - 例: `famima_01_ファミチキ（新味）.jpg`

## 機能詳細

### 自動検出

- ページを開くと自動的に新商品画像を検出します
- 複数のCSSセレクタパターンを試して、確実に画像を見つけます
  - `ul.ly-mod-list4 li img`
  - `ul.product-list li img`
  - `div.product-item img`
  - `li.item img`

### 画像URL取得

右クリック禁止サイトでも、以下の属性から画像URLを取得します：
- `src`
- `data-src`
- `data-original`
- `data-lazy-src`

### ダウンロード条件

- **5個以上の商品がある場合**: ダウンロードボタンが有効になります
- **5個未満の場合**: ボタンをクリックできますが、警告メッセージが表示されます

### サーバー負荷対策

- 各画像のダウンロード間隔を300ms設けて、サーバーに過度な負荷をかけないようにしています

## ファイル構成

```
famima-extension/
├── manifest.json          # 拡張機能の設定ファイル
├── background.js          # バックグラウンドスクリプト（バッジ管理）
├── content.js             # コンテンツスクリプト（DOM解析）
├── popup.html             # ポップアップUI
├── popup.js               # ポップアップのロジック
├── icon16.png             # アイコン (16x16)
├── icon48.png             # アイコン (48x48)
├── icon128.png            # アイコン (128x128)
├── generate_icons.py      # アイコン生成スクリプト
└── README.md              # このファイル
```

## カスタマイズ

### ダウンロード条件を変更

popup.js の以下の部分を編集：

```javascript
if (products.length < 5) {  // ここの数字を変更
  // ...
}
```

### 対象URLを変更

manifest.json の `content_scripts` セクションを編集：

```json
"matches": ["https://www.family.co.jp/goods/newgoods/nextweek.html"],
```

以下のように変更すると、今週の新商品や先週の新商品にも対応できます：

```json
"matches": [
  "https://www.family.co.jp/goods/newgoods.html",
  "https://www.family.co.jp/goods/newgoods/nextweek.html",
  "https://www.family.co.jp/goods/newgoods/lastweek.html"
],
```

### ダウンロードフォルダを変更

popup.js の以下の部分を編集：

```javascript
filename: `famima_images/${filename}`,  // フォルダ名を変更
```

## トラブルシューティング

### 拡張機能が動作しない

1. `chrome://extensions/` で拡張機能が有効になっているか確認
2. ページをリロードしてみる
3. 拡張機能を一度削除して、再度読み込む

### 画像が検出されない

1. ページが完全に読み込まれるまで待つ
2. ブラウザの開発者ツール（F12）でコンソールのエラーを確認
3. ファミリーマートのページ構造が変更された可能性があります
   - content.js の CSS セレクタを更新する必要があるかもしれません

### ダウンロードが失敗する

1. ダウンロード権限が許可されているか確認
2. ディスク容量が十分にあるか確認
3. ブラウザのダウンロード設定を確認

### 5個以上あるのにダウンロードできない

1. ポップアップに表示されている商品数を確認
2. ページを再読み込みしてみる
3. コンソールでエラーが出ていないか確認

## 技術仕様

- **Manifest Version**: 3
- **必要な権限**:
  - `downloads`: 画像のダウンロード
  - `activeTab`: 現在のタブへのアクセス
  - `https://www.family.co.jp/*`: ファミリーマートのサイトへのアクセス

## 開発

### アイコンの再生成

アイコンを変更したい場合：

```bash
cd famima-extension
python3 generate_icons.py
```

### デバッグ

1. `chrome://extensions/` で拡張機能の「詳細」をクリック
2. 「バックグラウンドページ」または「サービスワーカー」のリンクをクリックしてデバッグコンソールを開く
3. ポップアップを右クリックして「検証」を選択してポップアップのデバッグコンソールを開く

## 注意事項

- この拡張機能は個人的な利用を目的としています
- サイトに過度な負荷をかけないよう、適切な間隔で実行してください
- ファミリーマートの利用規約を遵守してください
- スクレイピングが規約違反となる場合は使用を控えてください
- ダウンロードした画像の著作権は株式会社ファミリーマートに帰属します

## バージョン履歴

### v1.0.0 (2025-10-22)
- 初回リリース
- 基本的な画像ダウンロード機能
- 5個以上の条件チェック
- バッジ表示機能
- プログレス表示

## ライセンス

MIT License

## 関連プロジェクト

このリポジトリには、Python版のスクレイパーも含まれています：
- `famima_scraper.py` - requests + BeautifulSoup版
- `famima_scraper_selenium.py` - Selenium版（推奨）

詳細は `README_FAMIMA_SCRAPER.md` を参照してください。
