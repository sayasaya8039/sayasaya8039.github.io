# FamilyMart Product Images Chrome Extension

ファミリーマート公式サイトの新商品ページから、商品画像を一括で検出・ダウンロードするChrome拡張機能です。

## 機能

- ファミリーマート新商品ページで商品画像を自動検出
- 検出された商品の一覧表示
- ワンクリックで全商品画像を一括ダウンロード
- きれいなUI/UXデザイン

## インストール方法

### 1. Chrome拡張機能として読み込む

1. Chromeで `chrome://extensions/` を開く
2. 右上の「デベロッパーモード」をONにする
3. 「パッケージ化されていない拡張機能を読み込む」をクリック
4. このディレクトリ（`chrome-extension-familymart`）を選択

## 使い方

### 基本的な使い方

1. **ファミリーマートの新商品ページを開く**
   - https://www.family.co.jp/goods/newgoods.html （今週の新商品）
   - https://www.family.co.jp/goods/newgoods/nextweek.html （来週の新商品）
   - https://www.family.co.jp/goods/newgoods/lastweek.html （先週の新商品）

2. **拡張機能をインストール後、ページをリロード（F5）**
   - これを忘れると商品が検出されません！

3. **Chrome拡張機能のアイコンをクリック**

4. **ポップアップが開き、自動的に商品を検出します**
   - 検出された商品数が表示されます
   - 商品のプレビューが表示されます

5. **「🔍 商品を検出」ボタンで再検出も可能**

6. **「⬇️ 画像をダウンロード」ボタンで全画像を一括ダウンロード**

### 商品が検出されない場合

「検出された商品数: 0個」と表示される場合は、[トラブルシューティング](#トラブルシューティング) を参照してください。

## ダウンロード先

ダウンロードされた画像は、Chromeのデフォルトダウンロードフォルダ内の `famima_images` フォルダに保存されます。

ファイル名は `famima_01_商品名.jpg` のような形式になります。

## トラブルシューティング

### 商品が検出されない（0個と表示される）

これは最もよくある問題です。以下の手順で解決できます：

#### ステップ1: ページをリロードする

拡張機能をインストール/更新した後は、**必ずページをリロード（F5）**してください。
リロードしないと、コンテンツスクリプトが読み込まれません。

1. ファミリーマートの新商品ページを開く
2. **F5キーを押してページをリロード**
3. 拡張機能のアイコンをクリック

#### ステップ2: コンソールでデバッグ情報を確認

1. ファミリーマートの新商品ページで **F12キー** を押す
2. 開発者ツールが開くので、**Console** タブをクリック
3. 以下のようなメッセージが表示されるはずです：

```
=== 商品検出開始 ===
✓ セレクタ 'ul.ly-mod-list4 li' で 15 個の要素を発見
リスト項目から画像を検索中...
  ✓ 商品 1: ファミチキ（新味）
    画像: https://www.family.co.jp/...
  ✓ 商品 2: チーズドッグ
    画像: https://www.family.co.jp/...
  ...
=== 検出完了: 合計 15 個の商品 ===
```

#### ステップ3: エラーメッセージを確認

コンソールに以下のようなメッセージが表示される場合：

**「⚠ 商品が検出されませんでした」**
- ページ内のul要素数、li要素数、img要素数が表示されます
- これらの数が0の場合、ページがまだ読み込まれていない可能性があります
- 少し待ってから「🔍 商品を検出」ボタンをクリックしてください

**「Could not establish connection」**
- コンテンツスクリプトが読み込まれていません
- ページをリロード（F5）してください

**セレクタがすべて「見つかりません」**
- ファミリーマートのサイト構造が変更された可能性があります
- 後述の「セレクタの更新方法」を参照してください

#### ステップ4: 正しいURLか確認

拡張機能は以下のURLパターンでのみ動作します：
- `https://www.family.co.jp/goods/newgoods.html` （今週の新商品）
- `https://www.family.co.jp/goods/newgoods/nextweek.html` （来週の新商品）
- `https://www.family.co.jp/goods/newgoods/lastweek.html` （先週の新商品）

その他のページでは動作しません。

#### ステップ5: 拡張機能を再インストール

それでも動作しない場合：

1. `chrome://extensions/` を開く
2. この拡張機能の「削除」をクリック
3. もう一度「パッケージ化されていない拡張機能を読み込む」で読み込む
4. ファミリーマートのページを**リロード（F5）**
5. 拡張機能のアイコンをクリック

### よくある質問

**Q: 拡張機能のアイコンが表示されません**

A: 以下を確認してください：
1. `chrome://extensions/` を開く
2. 拡張機能が有効になっているか確認
3. 拡張機能のスイッチがONになっているか確認

**Q: ダウンロードした画像が見つかりません**

A: 画像は以下の場所に保存されます：
1. Chromeのデフォルトダウンロードフォルダ（通常は「ダウンロード」フォルダ）
2. その中の `famima_images` サブフォルダ
3. chrome://downloads/ でダウンロード履歴を確認できます

**Q: 一部の画像しかダウンロードされません**

A:
1. コンソール（F12）でエラーメッセージを確認してください
2. ネットワーク接続を確認してください
3. ファミリーマートのサーバーが応答していない可能性があります（時間をおいて再試行）

### セレクタの更新方法

サイト構造が変更された場合、`content.js` の `selectors` 配列を更新してください：

1. ファミリーマートの新商品ページを開く
2. F12で開発者ツールを開く
3. 要素を選択ツール（左上の矢印アイコン）をクリック
4. 商品画像をクリックして、HTML構造を確認
5. 商品リストの親要素のCSSセレクタを特定
6. `content.js` の `selectors` 配列に追加

## カスタマイズ

### ダウンロード先フォルダ名を変更

`popup.js` の以下の行を編集：

```javascript
filename: `famima_images/${filename}`,  // 好きなフォルダ名に変更
```

### 対象URLを変更

`manifest.json` の `content_scripts` セクションを編集：

```json
"matches": ["https://www.family.co.jp/goods/newgoods*"],
```

## ファイル構成

```
chrome-extension-familymart/
├── manifest.json       # 拡張機能の設定ファイル
├── content.js         # 商品検出スクリプト（ページ内で実行）
├── popup.html         # ポップアップUIのHTML
├── popup.js           # ポップアップUIの制御スクリプト
└── README.md          # このファイル
```

## 技術仕様

- Manifest Version: 3
- 必要な権限:
  - `activeTab`: 現在のタブの情報を取得
  - `downloads`: 画像のダウンロード
  - `scripting`: コンテンツスクリプトの動的注入
  - `https://www.family.co.jp/*`: ファミリーマートサイトへのアクセス

## 主な機能

1. **柔軟な商品検出**
   - 複数のCSSセレクタパターンを試行
   - 動的に読み込まれるコンテンツにも対応
   - 詳細なデバッグ情報をコンソールに出力

2. **自動リトライ機能**
   - コンテンツスクリプトが読み込まれていない場合、自動的に注入
   - ページの動的読み込みを考慮した検出ロジック

3. **ユーザーフレンドリーなUI**
   - 検出された商品のプレビュー表示
   - ワンクリックでの一括ダウンロード
   - わかりやすいエラーメッセージ

## 注意事項

- この拡張機能は個人的な利用を目的としています
- ファミリーマートの利用規約を遵守してください
- 過度なダウンロードはサーバーに負荷をかける可能性があるため、適切にご使用ください

## ライセンス

MIT License
